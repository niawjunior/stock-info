<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Info and Recommendation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@^2.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/feather-icons"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <!-- Navbar -->
    <nav class="bg-blue-600 p-4">
      <div class="container mx-auto flex justify-between items-center">
        <a href="#" class="text-white text-2xl font-bold">StockPro</a>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="container mx-auto p-8 bg-white rounded-lg shadow-md mt-8">
      <h1 class="text-4xl font-bold text-center text-blue-600 mb-8">
        Stock Information & Recommendation
      </h1>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages() %} {% if messages %}
      <ul class="bg-red-100 text-red-700 p-4 mb-4 rounded">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %} {% endwith %}

      <!-- Form -->
      <form method="POST" class="flex justify-center items-center gap-4 mb-10">
        <label for="ticker" class="text-lg font-semibold"
          >Enter Stock Ticker:</label
        >
        <input
          type="text"
          name="ticker"
          id="ticker"
          placeholder="AAPL, MSFT, TSLA"
          required
          class="p-2 border border-gray-300 rounded w-64 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <label for="interval" class="text-lg font-semibold"
          >Choose Interval:</label
        >
        <select
          name="interval"
          id="interval"
          class="p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="5m">5 Minutes</option>
          <option value="1m">1 Minute</option>
          <option value="15m">15 Minutes</option>
          <option value="1h">1 Hour</option>
          <option value="1d">Daily</option>
          <option value="1wk">Weekly</option>
        </select>
        <input
          type="submit"
          value="Get Info"
          class="p-2 bg-blue-500 text-white font-semibold rounded hover:bg-blue-700 transition-colors cursor-pointer"
        />
      </form>

      {% if stock_info %}
      <!-- Stock Information Card -->
      <div class="stock-info bg-blue-50 p-6 rounded-lg mb-6 shadow-lg">
        <h2 class="text-3xl font-bold text-blue-600 mb-6">
          Stock Information for {{ stock_info.symbol }}
        </h2>
        <div class="grid grid-cols-2 gap-2">
          <p>
            <strong>Current Price:</strong>
            <span id="current-price">{{ stock_info.current_price }}</span>
          </p>
          <p>
            <strong>Market Cap:</strong>
            <span id="market-cap">{{ stock_info.market_cap }}</span>
          </p>
          <p><strong>P/E Ratio:</strong> {{ stock_info.pe_ratio }}</p>
          <p>
            <strong>Dividend Yield:</strong>
            <span id="div-yield">{{ stock_info.div_yield }}</span>
          </p>
          <p>
            <strong>Open Price:</strong>
            <span id="open-price">{{ stock_info.open_price }}</span>
          </p>
          <p>
            <strong>High Price:</strong>
            <span id="high-price">{{ stock_info.high_price }}</span>
          </p>
          <p>
            <strong>Low Price:</strong>
            <span id="low-price">{{ stock_info.low_price }}</span>
          </p>
          <p>
            <strong>52-Week High:</strong>
            <span id="fifty-two-week-high"
              >{{ stock_info.fifty_two_week_high }}</span
            >
          </p>
          <p>
            <strong>52-Week Low:</strong>
            <span id="fifty-two-week-low"
              >{{ stock_info.fifty_two_week_low }}</span
            >
          </p>
          <p>
            <strong>Volume:</strong>
            <span id="volume">{{ stock_info.volume }}</span>
          </p>
          <p><strong>EPS (TTM):</strong> {{ stock_info.eps }}</p>
          <p>
            <strong>Employees:</strong>
            <span id="employees">{{ stock_info.employees }}</span>
          </p>
          <p><strong>Sector:</strong> {{ stock_info.sector }}</p>
        </div>
      </div>
      <!-- Company Description -->
      <div class="mt-6">
        <h3 class="text-2xl font-semibold mb-2">Company Description</h3>
        <p class="text-justify">{{ stock_info.description }}</p>
      </div>

      <!-- News Section -->
      <div class="news-section mt-10">
        <h3 class="text-2xl font-semibold text-blue-600 mb-4">Latest News</h3>
        <div class="space-y-4">
          {% if news %} {% for article in news %}
          <div
            class="news-item bg-gray-100 p-4 rounded-lg shadow hover:bg-gray-200 transition"
          >
            <h4 class="text-xl font-semibold">
              <a
                href="{{ article.url }}"
                target="_blank"
                class="hover:underline"
                >{{ article.title }}</a
              >
            </h4>
            <p class="text-sm text-gray-600">{{ article.description }}</p>
            <p class="text-sm mt-2 text-gray-500">
              <span>Source: {{ article.source }}</span> |
              <span>Published: {{ article.published_at }}</span>
            </p>
          </div>
          {% endfor %} {% else %}
          <p>No news available for this stock at the moment.</p>
          {% endif %}
        </div>
      </div>

      <!-- Technical Analysis Card -->
      <div
        class="technical-analysis bg-green-50 p-6 rounded-lg mb-6 shadow-lg mt-4"
      >
        <h2 class="text-3xl font-bold text-green-600 mb-6">
          Technical Analysis
        </h2>

        <div class="grid grid-cols-2 gap-4">
          <!-- RSI Section -->
          <div>
            <h3 class="text-lg font-semibold">RSI</h3>
            <p>{{ technicals.latest_rsi | round(2) }}</p>
            <p class="text-sm text-gray-600">
              {% if technicals.latest_rsi < 20 %}
              <strong>RSI is less than 20:</strong> The stock is very oversold,
              suggesting a Strong Buy. {% elif technicals.latest_rsi < 30 %}
              <strong>RSI is between 20 and 30:</strong> The stock is oversold,
              suggesting a Buy. {% elif technicals.latest_rsi < 70 %}
              <strong>RSI is between 30 and 70:</strong> The stock is in neutral
              territory. {% elif technicals.latest_rsi < 80 %}
              <strong>RSI is between 70 and 80:</strong> The stock is
              overbought, suggesting a Sell. {% else %}
              <strong>RSI is above 80:</strong> The stock is very overbought,
              suggesting a Strong Sell. {% endif %}
            </p>
          </div>

          <!-- MACD Section -->
          <div>
            <h3 class="text-lg font-semibold">MACD</h3>
            <p>MACD: {{ technicals.latest_macd | round(2) }}</p>
            <p>Signal: {{ technicals.latest_macd_signal | round(2) }}</p>
            <p class="text-sm text-gray-600">
              {% if technicals.latest_macd > technicals.latest_macd_signal %} {%
              if technicals.latest_macd - technicals.latest_macd_signal > 0.5 %}
              <strong>Strong Buy signal</strong>
              {% else %} Buy signal {% endif %} {% else %} {% if
              technicals.latest_macd_signal - technicals.latest_macd > 0.5 %}
              <strong>Strong Sell signal</strong>
              {% else %} Sell signal {% endif %} {% endif %}
            </p>
          </div>

          <!-- ADX Section -->
          <div>
            <h3 class="text-lg font-semibold">ADX</h3>
            <p>{{ technicals.latest_adx | round(2) }}</p>
            <p class="text-sm text-gray-600">
              {% if technicals.latest_adx > 25 %} The trend is strong. {% else
              %} The trend is weak or nonexistent. {% endif %}
            </p>
          </div>

          <!-- Bollinger Bands Section -->
          <div>
            <h3 class="text-lg font-semibold">Bollinger Bands</h3>
            <p>Upper Band: {{ technicals.latest_upper_bb | round(2) }}</p>
            <p>Lower Band: {{ technicals.latest_lower_bb | round(2) }}</p>
          </div>

          <!-- EMA Section -->
          <div>
            <h3 class="text-lg font-semibold">EMA Crossover</h3>
            <p>50 EMA: {{ technicals.latest_ema_50 | round(2) }}</p>
            <p>
              200 EMA: {% if technicals.latest_ema_200 %} {{
              technicals.latest_ema_200 | round(2) }} {% else %} None {% endif
              %}
            </p>
          </div>

          <!-- Support and Resistance -->
          <div>
            <h3 class="text-lg font-semibold">Target Price</h3>
            <p>Resistance: {{ technicals.resistance_level | round(2) }}</p>
            <p>Support: {{ technicals.support_level | round(2) }}</p>
          </div>
        </div>

        <!-- Recommendation -->
        <h3 class="text-xl font-bold text-green-600 mt-6">
          Recommendation: {{ technicals.recommendation }}
        </h3>
      </div>

      <!-- Graphs Section -->
      <div class="flex gap-8 mb-8">
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-center mb-4">
            Real-Time {{ interval }} Interval Graph
          </h3>
          <img
            src="data:image/png;base64,{{ graph_realtime_url }}"
            alt="Real-Time Stock Graph"
            class="rounded-lg shadow-md hover:shadow-lg transition-shadow"
          />
        </div>
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-center mb-4">
            Monthly Trendline Graph (5 Years)
          </h3>
          <img
            style="min-height: 444px"
            src="data:image/png;base64,{{ graph_monthly_url }}"
            alt="Monthly Trendline Stock Graph"
            class="rounded-lg shadow-md hover:shadow-lg transition-shadow"
          />
        </div>
      </div>

      <!-- RSI with SMA Graph -->
      <h3 class="text-lg font-semibold text-center mt-8 mb-4">
        RSI with SMA Overlay
      </h3>
      <div class="flex justify-center">
        <img
          src="data:image/png;base64,{{ rsi_graph }}"
          alt="RSI with SMA Overlay Graph"
          class="rounded-lg shadow-lg hover:shadow-xl transition-shadow"
        />
      </div>
      {% endif %}
    </div>

    <script>
      feather.replace()
    </script>

    <script>
      // JavaScript to format the numbers
      function formatNumber(num) {
        if (num === null || num === "None") return "N/A"
        if (num >= 1_000_000_000_000)
          return (num / 1_000_000_000_000).toFixed(2) + "T"
        if (num >= 1_000_000_000) return (num / 1_000_000_000).toFixed(2) + "B"
        if (num >= 1_000_000) return (num / 1_000_000).toFixed(2) + "M"
        return num.toLocaleString()
      }

      function formatPercentage(num) {
        if (num === null || num === "None") return "N/A"
        return (num * 100).toFixed(2) + "%"
      }

      // Apply formatting to stock information
      document.getElementById("current-price").textContent = formatNumber(
        parseFloat(document.getElementById("current-price").textContent)
      )
      document.getElementById("market-cap").textContent = formatNumber(
        parseFloat(document.getElementById("market-cap").textContent)
      )
      document.getElementById("volume").textContent = formatNumber(
        parseFloat(document.getElementById("volume").textContent)
      )
      document.getElementById("div-yield").textContent = formatPercentage(
        parseFloat(document.getElementById("div-yield").textContent)
      )
      document.getElementById("open-price").textContent = formatNumber(
        parseFloat(document.getElementById("open-price").textContent)
      )
      document.getElementById("high-price").textContent = formatNumber(
        parseFloat(document.getElementById("high-price").textContent)
      )
      document.getElementById("low-price").textContent = formatNumber(
        parseFloat(document.getElementById("low-price").textContent)
      )
      document.getElementById("fifty-two-week-high").textContent = formatNumber(
        parseFloat(document.getElementById("fifty-two-week-high").textContent)
      )
      document.getElementById("fifty-two-week-low").textContent = formatNumber(
        parseFloat(document.getElementById("fifty-two-week-low").textContent)
      )
      document.getElementById("employees").textContent = formatNumber(
        parseFloat(document.getElementById("employees").textContent)
      )
    </script>
  </body>
</html>
